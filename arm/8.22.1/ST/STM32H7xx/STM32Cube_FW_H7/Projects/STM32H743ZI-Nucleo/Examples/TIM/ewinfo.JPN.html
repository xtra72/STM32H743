<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml11.xsd"
     xml:lang="en">
  <head>
    <title>Information Center for ARM</title>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <link type="text/css" rel="stylesheet" media="all" href="file://$TOOLKIT_DIR$/doc/infocenter/style/ewic.css" />
  </head>
  <body>
  <div id="topbanner"></div>
  <div id="titlebanner_small">
    <h2>Information Center for ARM</h2>
  </div>
  <div class="breadcrumb"><a href="$TOOLKIT_DIR$/doc/infocenter/index.JPN.html">Information Center for ARM</a> | EXAMPLES</div>
  <div class="mainblock">
   <h2>Example description</h2>

   <pre>  <!--Insert readme.txt-->
<span style="font-family: monospace;">
<h1>TIM Workspace</h1>

=====================================================================================
<b>TIM_6steps</b>
Timers Synchronization example
=====================================================================================

<u>Example Description</u>

This example shows how to configure the TIM1 peripheral to generate 6 Steps.
The STM32H743xx TIM1 peripheral offers the possibility to program in advance the
configuration for the next TIM1 outputs behaviour (step) and change the configuration
of all the channels at the same time. This operation is possible when the COM
(commutation) event is used.

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals, D2 Domain AHB1/AHB2 peripherals
and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals
and D3 Domain APB4 peripherals to  run at 100MHz

The COM event can be generated by software by setting the COM bit in the TIM1_EGR
register or by hardware (on TRC rising edge).
In this example, a software COM event is generated each 1 ms: using the SysTick
interrupt.

The TIM1 is configured in Timing Mode, each time a COM event occurs, a new TIM1
configuration will be set in advance. Only changed states are programmed.

The break Polarity is used at High level.

The following Table describes the TIM1 Channels states:

                     -----------------------------------------------
                    | Step1 | Step2 | Step3 | Step4 | Step5 | Step6 |
          ----------------------------------------------------------
         |Channel1  | 1(PWM)|   0   |   0   |   0   |   0   |1(PWM) |
          ----------------------------------------------------------
         |Channel1N |   0   |   0   |1(PWM) |1(PWM) |   0   |   0   |
          ----------------------------------------------------------
         |Channel2  |   0   |   0   |   0   |1(PWM) |1(PWM) |   0   |
          ----------------------------------------------------------
         |Channel2N |1(PWM) |1(PWM) |   0   |   0   |   0   |   0   |
          ----------------------------------------------------------
         |Channel3  |   0   |1(PWM) |1(PWM) |   0   |   0   |   0   |
          ----------------------------------------------------------
         |Channel3N |   0   |   0   |   0   |   0   |1(PWM) |1(PWM) |
          -----------------------------------------------------------

 Channel1  (PA.08)   |||||||_________________________________||||||||||||||_________________________________|||||||
 Channel1N (PB.13)   _______________||||||||||||||||_______________________________||||||||||||||||________________

 Channel2  (PA.09)   _______________________||||||||||||||||_______________________________||||||||||||||||________
 Channel2N (PB.14)   |||||||||||||||________________________________|||||||||||||||________________________________

 Channel3  (PE.13)   _______||||||||||||||||_______________________________||||||||||||||||________________________
 Channel3N (PE.12)   ________________________________|||||||||||||||________________________________|||||||||||||||


<u>Directory contents</u>

  - TIM/TIM_6steps/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_6steps/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_6steps/Inc/main.h                  Header for main.c module
  - TIM/TIM_6steps/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_6steps/Src/main.c                  Main program
  - TIM/TIM_6steps/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_6steps/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STM32H743ZI-Nucleo board and can be
    easily tailored to any other supported device and development board.

  - STM32H743ZI-Nucleo Set-up
   Connect the following pins to an oscilloscope to monitor the different waveforms:
      - TIM1_CH1  pin (PA.08 Pin23 of CN12)
      - TIM1_CH1N pin (PB.13 Pin30 of CN12)
      - TIM1_CH2  pin (PE.11 Pin56 of CN12)
      - TIM1_CH2N pin (PE.10 Pin47 of CN12)
      - TIM1_CH3  pin (PE.13 Pin55 of CN12)
      - TIM1_CH3N pin (PE.12 Pin49 of CN12)

    - Connect the TIM1 break pin TIM1_BKIN pin (PB.12(Pin16 of CN12) to the GND. To generate a
      break event, switch this pin level from 0V to 3.3V.


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files: Project-&gt;Rebuild all
 - Load project image: Project-&gt;Download and Debug
 - Run program: Debug-&gt;Go(F5)


=====================================================================================
<b>TIM_Asymetric</b>
TIM Asymetric example
=====================================================================================

<u>Example Description</u>

This example shows how to configure the TIM peripheral to generate an Asymetric signal.

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals, D2 Domain AHB1/AHB2 peripherals
and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals
and D3 Domain APB4 peripherals to  run at 100MHz

TIM8 is configured to generate an Asymetric signal with a programmable Phase-Shifted signal on TIM8_CH2:
   - TIM8 Channel 1 is configured in PWM2 mode
   - TIM8 Channel 2 is configured in Asymetric PWM2 mode
   - The counter mode is center aligned mode
   - The pulse length and the phase shift are programmed consecutively in TIM8_CCR2 and TIM8_CCR1.

TIM1 is configured to generating the reference signal on Channel1 used by TIM8:
    - TIM1 is generating a PWM signal with frequency equal to 4.54 KHz
    - TIM1 is used as master for TIM8, the update event of TIM1 genarates the Reset counter
      of TIM8 to synchronize the two signals: the reference signal (TIM1_CH1) and
            the shifted signal (TIM8_CH2).

    In this example TIM1 and TIM8 input clock (TIM8CLK) is set to APB2 clock (2*PCLK2)
    TIM1 and TIM8 signals are at frequency of  ((SystemCoreClock/2) / (Period  + 1))

    TIM8 is generating a signal with the following caracteristics:
    - Pulse lenght = (TIM8_CCR1 + TIM8_CCR2) / TIM8_CLK
    - Phase shift = TIM8_CCR2/TIM8_CLK
      with TIM8_CLK = ((SystemCoreClock/2) / (Period + 1)), as the prescaler is equal to zero.
 The Pulse is low level of the output signal of Channel 2 because TIM cannel is configured as Asymetric PWM2 mode.

Note: Care must be taken when using HAL_Delay(), this function provides accurate delay (in milliseconds)
      based on variable incremented in SysTick ISR. This implies that if HAL_Delay() is called from
      a peripheral ISR process, then the SysTick interrupt must have higher priority (numerically lower)
      than the peripheral interrupt. Otherwise the caller ISR process will be blocked.
      To change the SysTick interrupt priority you have to use HAL_NVIC_SetPriority() function.

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_Asymetric/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_Asymetric/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_Asymetric/Inc/main.h                  Header for main.c module
  - TIM/TIM_Asymetric/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_Asymetric/Src/main.c                  Main program
  - TIM/TIM_Asymetric/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_Asymetric/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STMicroelectronics STM32H743ZI-Nucleo
    board and can be easily tailored to any other supported device
    and development board.

  - STM32H743ZI-Nucleo Set-up
    - Connect the following pins to an oscilloscope to monitor the different
      waveforms:
       - TIM1_CH1 (PA.08 Pin23 of CN12)
       - TIM8_CH1 (PC.06 Pin04 of CN12)
       - TIM8_CH2 (PC.07 Pin19 of CN12)
    The shift is measured using the TIM1_CH1 as reference signal.


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example


=====================================================================================
<b>TIM_Combined</b>
TIM combined example
=====================================================================================

<u>Example Description</u>

This example shows how to configure the TIM1 peripheral to generate 3 PWM combined
signals with TIM1 Channel5.

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

TIM1 input clock (TIM1CLK) is set to APB2 clock (PCLK2)=&gt; TIM1CLK = 2*PCLK2 = 2*(SystemCoreClock/4)
TIM1CLK = SystemCoreClock/2, Prescaler = 0, TIM1 counter clock = SystemCoreClock/2

The objective is to generate 3 combined PWM signal at 8.78 KHz (in center aligned mode):
    - TIM1_Period = ((2*PCLK2) / (8.78*2)) - 1
 The channel 1  duty cycle is set to 50%.
 The channel 2  duty cycle is set to 37.5%.
 The channel 3  duty cycle is set to 25%.

The Timer pulse is calculated as follows:
  - ChannelxPulse = DutyCycle * (TIM1_Period - 1) / 100

The channel 5  is used in PWM2 mode with duty cycle set to 6.22%.

The 3 resulting signals are made of an AND logical combination of two reference PWMs:
  - Channel 1 and Channel 5
  - Channel 2 and Channel 5
  - Channel 3 and Channel 5

The TIM1 waveform can be displayed using an oscilloscope.
                    ______   ______                  _______   ______
                   |      | |      |                |       | |      |
TIM1_CH1(PA.08)____|      |_|      |________________|       |_|      |__________
                      ____   ____                       ____   ____
                     |    | |    |                     |    | |    |
TIM1_CH2(PA.09)______|    |_|    |_____________________|    |_|    |___________
                        __   __                           __   __
                       |  | |  |                         |  | |  |
TIM1_CH3(PA.10)________|  |_|  |_________________________|  |_|  |______________

Note: Care must be taken when using HAL_Delay(), this function provides accurate delay (in milliseconds)
      based on variable incremented in SysTick ISR. This implies that if HAL_Delay() is called from
      a peripheral ISR process, then the SysTick interrupt must have higher priority (numerically lower)
      than the peripheral interrupt. Otherwise the caller ISR process will be blocked.
      To change the SysTick interrupt priority you have to use HAL_NVIC_SetPriority() function.

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_Combined/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_Combined/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_Combined/Inc/main.h                  Header for main.c module
  - TIM/TIM_Combined/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_Combined/Src/main.c                  Main program
  - TIM/TIM_Combined/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_Combined/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743I devices.

  - This example has been tested with STMicroelectronics STM32H743ZI-NUCLEO
    board and can be easily tailored to any other supported device
    and development board.

  - STM32H743ZI-NUCLEO Set-up
    - Connect the following pins to an oscilloscope to monitor the different
      waveforms:
        - TIM1_CH1 (PA.08: pin23 of CN12)
        - TIM1_CH2 (PA.09: pin21 of CN12)
        - TIM1_CH3 (PA.10: pin33 of CN12)


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example


=====================================================================================
<b>TIM_ComplementarySignals</b>
TIM Complementary Signals example
=====================================================================================

<u>Example Description</u>

This example shows how to configure the TIM1 peripheral to generate three
complementary TIM1 signals, to insert a defined dead time value, to use the break
feature and to lock the desired parameters.

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

TIM1CLK is fixed to SystemCoreClock, the TIM1 Prescaler is set to have
TIM1 counter clock = 20MHz.

The objective is to generate PWM signal at 10 KHz:
  - TIM1_Period = (TIM1 counter clock / 2000) - 1

The Three Duty cycles are computed as the following description:
The channel 1 duty cycle is set to 50% so channel 1N is set to 50%.
The channel 2 duty cycle is set to 25% so channel 2N is set to 75%.
The channel 3 duty cycle is set to 12.5% so channel 3N is set to 87.5%.
The Timer pulse is calculated as follows:
  - ChannelxPulse = DutyCycle * (TIM1_Period - 1) / 100

A dead time equal to 100/SystemCoreClock (around 0.5us) is inserted between
the different complementary signals, and the Lock level 1 is selected.
  - The OCx output signal is the same as the reference signal except for the rising edge,
    which is delayed relative to the reference rising edge.
  - The OCxN output signal is the opposite of the reference signal except for the rising
    edge, which is delayed relative to the reference falling edge

Note that calculated duty cycles apply to the reference signal (OCxREF) from
which outputs OCx and OCxN are generated. As dead time insertion is enabled the
duty cycle measured on OCx will be slightly lower.

The break Polarity is used at High level.

The TIM1 waveforms can be displayed using an oscilloscope.

Note: Care must be taken when using HAL_Delay(), this function provides accurate delay (in milliseconds)
      based on variable incremented in SysTick ISR. This implies that if HAL_Delay() is called from
      a peripheral ISR process, then the SysTick interrupt must have higher priority (numerically lower)
      than the peripheral interrupt. Otherwise the caller ISR process will be blocked.
      To change the SysTick interrupt priority you have to use HAL_NVIC_SetPriority() function.

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_ComplementarySignals/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_ComplementarySignals/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_ComplementarySignals/Inc/main.h                  Header for main.c module
  - TIM/TIM_ComplementarySignals/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_ComplementarySignals/Src/main.c                  Main program
  - TIM/TIM_ComplementarySignals/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_ComplementarySignals/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STMicroelectronics STM32H743ZI-NUCLEO
    board and can be easily tailored to any other supported device
    and development board.

  - STM32H743ZI-Nucleo Set-up
    - Connect the TIM1 pins to an oscilloscope to monitor the different waveforms:
      - TIM1_CH1  pin (PA.08 Pin23 of CN12)
      - TIM1_CH1N pin (PB.13 Pin30 of CN12)
      - TIM1_CH2  pin (PA.09 Pin21 of CN12)
      - TIM1_CH2N pin (PE.10 pin47 of CN12)
      - TIM1_CH3  pin (PA.10 Pin33 of CN12)
      - TIM1_CH3N pin (PB.15 Pin26 of CN12)

    - Connect the TIM1 break pin TIM1_BKIN pin (PB.12 Pin16 of CN12) to the GND. To generate a
      break event, switch this pin level from 0V to 3.3V.


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example


=====================================================================================
<b>TIM_DMA</b>
TIM DMA example
=====================================================================================

<u>Example Description</u>

This example provides a description of how to use DMA with TIMER Update request
to transfer Data from memory to TIMER Capture Compare Register 3 (TIMx_CCR3).

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

The following configuration values are used in this example:

  - TIM3CLK = 2*PCLK2 = HCLK
  - Counter repetition = 3
  - Prescaler = 0
  - TIM3 counter clock = HCLK

  The objective is to configure TIM3 channel 3 to generate complementary PWM
  (Pulse Width Modulation) signal with a frequency equal to 17.57 KHz, and a variable
  duty cycle that is changed by the DMA after a specific number of Update DMA request.

  The number of this repetitive requests is defined by the TIM3 Repetition counter,
  each 4 Update Requests, the TIM3 Channel 3 Duty Cycle changes to the next new
  value defined by the aCCValue_Buffer.

  The PWM waveform can be displayed using an oscilloscope.

  In nominal mode (except at start) , it should looks like this :

       .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .
        ___________     _______         ___             ___________    __
      _|           |___|       |_______|   |___________|           |__|
       &lt;----57us -----&gt;&lt;----57us -----&gt;&lt;----57us -----&gt;&lt;----57us -----&gt;

Note: PWM signal frequency value mentioned above is theoretical (obtained when the system clock frequency
      is exactly 400 MHz). Since the generated system clock frequency may vary from one board to another observed
      PWM signal frequency might be slightly different.

Note: Care must be taken when using HAL_Delay(), this function provides accurate
      delay (in milliseconds) based on variable incremented in SysTick ISR. This
      implies that if HAL_Delay() is called from a peripheral ISR process, then
      the SysTick interrupt must have higher priority (numerically lower)

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_DMA/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_DMA/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_DMA/Inc/main.h                  Header for main.c module
  - TIM/TIM_DMA/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_DMA/Src/main.c                  Main program
  - TIM/TIM_DMA/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_DMA/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STMicroelectronics STM32H743ZI-Nucleo
    board and can be easily tailored to any other supported device
    and development board.

  - STM32H743ZI-Nucleo Set-up
    - Connect the TIM3 pin to an oscilloscope to monitor the different waveforms:
    - TIM3 CH3 (PB.0 Pin34 of CN11)


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example


=====================================================================================
<b>TIM_DMABurst</b>
TIM_DMABurst example
=====================================================================================

<u>Example Description</u>

This example shows how to update the TIMER channel1 period and the duty cycle
using the TIMER DMA burst feature.

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

Every update DMA request, the DMA will do 3 transfers of half words into Timer
registers beginning from ARR register.
On the DMA update request, 0x0FFF will be transferred into ARR, 0x0000
will be transferred into RCR (if supported), 0x0555 will be transferred into CCR1.

The TIM2CLK frequency is set to (2*PCLK1 = HCLK), to get TIM2 counter
clock at 20 MHz the Prescaler is computed as following:
- Prescaler = (TIM2CLK / TIM2 counter clock) - 1

The TIM2 Frequency = TIM2 counter clock/(ARR + 1)
                   = 20 MHz / 4096 = 4.88 KHz

The TIM2 CCR1 register value is equal to 0x555, so the TIM2 Channel 1 generates a
PWM signal with a frequency equal to 4.88 KHz and a duty cycle equal to 33.33%:
TIM2 Channel1 duty cycle = (TIM2_CCR1/ TIM2_ARR + 1)* 100 = 33.33%

The PWM waveform can be displayed using an oscilloscope.

Note: Care must be taken when using HAL_Delay(), this function provides accurate
      delay (in milliseconds) based on variable incremented in SysTick ISR. This
      implies that if HAL_Delay() is called from a peripheral ISR process, then
      the SysTick interrupt must have higher priority (numerically lower)
      than the peripheral interrupt. Otherwise the caller ISR process will be blocked.
      To change the SysTick interrupt priority you have to use HAL_NVIC_SetPriority() function.

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_DMABurst/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_DMABurst/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_DMABurst/Inc/main.h                  Header for main.c module
  - TIM/TIM_DMABurst/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_DMABurst/Src/main.c                  Main program
  - TIM/TIM_DMABurst/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_DMABurst/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STMicroelectronics STM32H743ZI-Nucleo
    board and can be easily tailored to any other supported device
    and development board.

  - STM32H743ZI-Nucleo Set-up
    - Connect the TIM2 output channel to an oscilloscope to monitor the different waveforms:
    - TIM2 CH1 (PA.00 Pin28 of CN11)


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example


=====================================================================================
<b>TIM_InputCapture</b>
Input Capture example
=====================================================================================

<u>Example Description</u>

  This example shows how to use the TIM peripheral to measure the frequency of
  an external signal.

 At the beginning of the main program the HAL_Init() function is called to reset
  all the peripherals, initialize the Flash interface and the systick.
  The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
  The CPU at 400MHz
  The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
  The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

  The TIM1CLK frequency is set to 2*PCK2 = HCLK = SystemCoreClock/2 (Hz), the Prescaler is 0,
  so the TIM1 counter clock is SystemCoreClock/2 (Hz).

  TIM1 is configured in Input Capture Mode: the external signal is connected to
  TIM1 Channel2 used as input pin.
  To measure the frequency we use the TIM1 CC2 interrupt request, so in the
  TIM1_CC_IRQHandler routine, the frequency of the external signal is computed.

  The "uwFrequency" variable contains the external signal frequency:
  uwFrequency = TIM1 counter clock / uwDiffCapture (Hz),
  where "uwDiffCapture" is the difference between two consecutive TIM1 captures.

  The minimum frequency value to measure is TIM1 counter clock / CCR MAX
                                              = 200 MHz / 65535

  Due to TIM1_CC_IRQHandler processing time (around 5ns), the minimum
  frequency value to measure is around 4kHz.

Note: Care must be taken when using HAL_Delay(), this function provides accurate delay (in milliseconds)
      based on variable incremented in SysTick ISR. This implies that if HAL_Delay() is called from
      a peripheral ISR process, then the SysTick interrupt must have higher priority (numerically lower)
      than the peripheral interrupt. Otherwise the caller ISR process will be blocked.
      To change the SysTick interrupt priority you have to use HAL_NVIC_SetPriority() function.

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_InputCapture/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_InputCapture/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_InputCapture/Inc/main.h                  Header for main.c module
  - TIM/TIM_InputCapture/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_InputCapture/Src/main.c                  Main program
  - TIM/TIM_InputCapture/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_InputCapture/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STM32H743ZI-Nucleo board and can be
    easily tailored to any other supported device and development board.
  - Connect an external signal to TIM1 Channel2 (PE11 Pin56 of CN12)..


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example


=====================================================================================
<b>TIM_OCToggle</b>
TIM_OCToggle example
=====================================================================================

<u>Example Description</u>

  This example shows how to configure the TIM peripheral to generate four different
  signals with four different frequencies.

 At the beginning of the main program the HAL_Init() function is called to reset
  all the peripherals, initialize the Flash interface and the systick.
  The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
  The CPU at 400MHz
  The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
  The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

  The TIM1 frequency is set to 2*PCLK2 = HCLK = SystemCoreClock/2 (HZ), and the objective is
  to get TIM1 counter clock at 20 MHz so the Prescaler is computed as following:
     - Prescaler = (TIM1CLK /TIM1 counter clock) - 1

  The TIM1 CCR1 register value is equal to 40961:
  CC1 update rate = TIM1 counter clock / CCR1_Val = 488.269 Hz,
  so the TIM1 Channel 1 generates a periodic signal with a frequency equal to 244.13 Hz.

  The TIM1 CCR2 register value is equal to 20480:
  CC2 update rate = TIM1 counter clock / CCR2_Val = 976.56 Hz,
  so the TIM1 channel 2 generates a periodic signal with a frequency equal to 488.28 Hz.

  The TIM1 CCR3 register value is equal to 10240:
  CC3 update rate = TIM1 counter clock / CCR3_Val = 1953.1 Hz,
  so the TIM1 channel 3 generates a periodic signal with a frequency equal to 976.56 Hz.

  The TIM1 CCR4 register value is equal to 5120:
  CC4 update rate = TIM1 counter clock / CCR4_Val =  3906.25 Hz,
  so the TIM1 channel 4 generates a periodic signal with a frequency equal to 1953.12 Hz.

Note: PWM signal frequency values mentioned above are theoretical (obtained when the system clock frequency
      is exactly 400 MHz). Since the generated system clock frequency may vary from one board to another observed
      PWM signal frequency might be slightly different.

Note: Care must be taken when using HAL_Delay(), this function provides accurate delay (in milliseconds)
      based on variable incremented in SysTick ISR. This implies that if HAL_Delay() is called from
      a peripheral ISR process, then the SysTick interrupt must have higher priority (numerically lower)
      than the peripheral interrupt. Otherwise the caller ISR process will be blocked.
      To change the SysTick interrupt priority you have to use HAL_NVIC_SetPriority() function.

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_OCToggle/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_OCToggle/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_OCToggle/Inc/main.h                  Header for main.c module
  - TIM/TIM_OCToggle/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_OCToggle/Src/main.c                  Main program
  - TIM/TIM_OCToggle/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_OCToggle/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STMicroelectronics STM32H743ZI-Nucleo
    board and can be easily tailored to any other supported device
    and development board.

  - STM32H743ZI-Nucleo Set-up
   Connect the following pins to an oscilloscope to monitor the different waveforms:
      - TIM1_CH1  (PA.08 Pin23 of CN12)
      - TIM1_CH2  (PA.09 Pin21 of CN12)
      - TIM1_CH3  (PA.10 Pin33 of CN12)
      - TIM1_CH4  (PE.14 Pin51 of CN12)


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example


=====================================================================================
<b>TIM_OnePulse</b>
TIM One Pulse example
=====================================================================================

<u>Example Description</u>

This example shows how to use the TIMER peripheral to generate a single pulse when
a rising edge of an external signal is received on the TIMER Input pin.

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz
Clock setup for TIM4

================================

  TIM4CLK = 2*PCLK2 = 200 MHz.

  Prescaler = (TIM4CLK /TIM4 counter clock) - 1

  The prescaler value is computed in order to have TIM4 counter clock
  set at 20000000 Hz.

  The Autoreload value is 65535 (TIM4-&gt;ARR), so the maximum frequency value to
  trigger the TIM4 input is 20000000/65535 [Hz].

Configuration of TIM4 in One Pulse Mode
===================================================

  - The external signal is connected to TIM4_CH2 pin (PD.13),
    and a rising edge on this input is used to trigger the Timer.
  - The One Pulse signal is output on TIM4_CH1 (PD.12).

  The delay value is fixed to:
   - Delay =  CCR1/TIM4 counter clock
           = 16383 / 20000000 [sec]

  The pulse value is fixed to :
   - Pulse value = (TIM_Period - TIM_Pulse)/TIM4 counter clock
                 = (65535 - 16383) / 20000000 [sec]

  The one pulse waveform can be displayed using an oscilloscope and it looks
  like this.

                                ___
                               |   |
  CH2 _________________________|   |__________________________________________

                                             ___________________________
                                            |                           |
  CH1 ______________________________________|                           |_____
                               &lt;---Delay----&gt;&lt;------Pulse---------------&gt;


<u>Directory contents</u>

  - TIM/TIM_OnePulse/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_OnePulse/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_OnePulse/Inc/main.h                  Header for main.c module
  - TIM/TIM_OnePulse/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_OnePulse/Src/main.c                  Main program
  - TIM/TIM_OnePulse/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_OnePulse/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

   - This example runs on STM32H743xx devices.

  - This example has been tested with STM32H743ZI-Nucleo board and can be
    easily tailored to any other supported device and development board.

  - STM32H743ZI-Nucleo Set-up
   - Connect the external signal to the TIM4_CH2 pin (PD.13) (pin 41 in CN12 connector)
   - Connect the TIM4_CH1 pin(PD.12) (pin 43 in CN12 connector) to an oscilloscope to monitor the waveform.


<u>How to use it ?</u>

In order to make the program work, you must do the following :
- Rebuild all files and load your image into target memory
- Run the example


=====================================================================================
<b>TIM_PWMOutput</b>
TIM PWM Output example
=====================================================================================

<u>Example Description</u>

This example shows how to configure the TIM peripheral in PWM (Pulse Width Modulation)
mode.

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

In this example TIM1 input clock (TIM1CLK) is set to APB2 clock (PCLK2),
since APB2 prescaler is equal to 2.
  TIM1CLK = 2*PCLK2
  PCLK2 = HCLK/2
  =&gt; TIM1CLK = HCLK

To get TIM1 counter clock at 20 MHz, the prescaler is computed as follows:
  Prescaler = (TIM1CLK / TIM1 counter clock) - 1
  Prescaler = ((HCLK) /2*20 MHz) - 1

To get TIM1 output clock at 20 KHz, the period (ARR)) is computed as follows:
    ARR = (TIM1 counter clock / TIM1 output clock) - 1
        = 999

    TIM1 Channel1 duty cycle = (TIM1_CCR1/ TIM1_ARR + 1)* 100 = 50%
    TIM1 Channel2 duty cycle = (TIM1_CCR2/ TIM1_ARR + 1)* 100 = 37.5%
    TIM1 Channel3 duty cycle = (TIM1_CCR3/ TIM1_ARR + 1)* 100 = 25%
    TIM1 Channel4 duty cycle = (TIM1_CCR4/ TIM1_ARR + 1)* 100 = 12.5%

The PWM waveforms can be displayed using an oscilloscope.

Note: Care must be taken when using HAL_Delay(), this function provides accurate delay (in milliseconds)
      based on variable incremented in SysTick ISR. This implies that if HAL_Delay() is called from
      a peripheral ISR process, then the SysTick interrupt must have higher priority (numerically lower)
      than the peripheral interrupt. Otherwise the caller ISR process will be blocked.
      To change the SysTick interrupt priority you have to use HAL_NVIC_SetPriority() function.

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_PWMOutput/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_PWMOutput/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_PWMOutput/Inc/main.h                  Header for main.c module
  - TIM/TIM_PWMOutput/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_PWMOutput/Src/main.c                  Main program
  - TIM/TIM_PWMOutput/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_PWMOutput/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STMicroelectronics STM32H743ZI-Nucleo
    board and can be easily tailored to any other supported device
    and development board.

  - STM32H743ZI-Nucleo Set-up
   Connect the following pins to an oscilloscope to monitor the different waveforms:
        - TIM1_CH1 : PA.08 (CN12 pin 23)
        - TIM1_CH2 : PA.09 (CN12 pin 21)
        - TIM1_CH3 : PA.10 (CN12 pin 33)
        - TIM1_CH4 : PA.11 (CN12 pin 14)


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example


=====================================================================================
<b>TIM_Synchronization</b>
Timers Synchronization example
=====================================================================================

<u>Example Description</u>

This example shows how to synchronize TIM1 and Timers (TIM3 and TIM4) in parallel mode.

Timers synchronisation in parallel mode:

                                                       ___________
                                                 ITR0 |  SLAVE 1  |
                                     _________________|    TIM3   |
   ___________                      |                 |___________|
  |   MASTER  |TRGO_Update          |
  |    TIM1   |---------------------|
  |___________|                     |                  ___________
                                    |_________________|  SLAVE 2  |
                                                 ITR0 |    TIM4   |
                                                      |___________|

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

1/ TIM1 is configured as Master Timer:
   - PWM Mode is used
   - The TIM1 Update event is used as Trigger Output

2/ TIM3 and TIM4 are slaves for TIM1,
   - PWM Mode is used
   - The ITR0(TIM1) is used as input trigger for both slaves
   - Gated mode is used, so starts and stops of slaves counters
     are controlled by the Master trigger output signal(update event).

The TIM1 counter clock is 200 MHz.

  The Master Timer TIM1 is running at:
  TIM1 frequency = TIM1 counter clock / (TIM1_Period + 1) = 781.250 KHz and
  a the duty cycle equal to: TIM1_CCR1/(TIM1_ARR + 1) = 50%

  The TIM3 is running at:
  (TIM1 frequency)/ ((TIM3 period +1)* (TIM1_Repetition_Counter+1)) = 52.083 KHz and
  a duty cycle equal to TIM3_CCR1/(TIM3_ARR + 1) = 33.3%

  The TIM4 is running at:
  (TIM1 frequency)/ ((TIM4 period +1)* (Repetition_Counter+1)) = 78.125 KHz and
  a duty cycle equal to TIM4_CCR1/(TIM4_ARR + 1) = 50%

The PWM waveform can be displayed using an oscilloscope.


<u>Directory contents</u>

  - TIM/TIM_Synchronization/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_Synchronization/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_Synchronization/Inc/main.h                  Header for main.c module
  - TIM/TIM_Synchronization/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_Synchronization/Src/main.c                  Main program
  - TIM/TIM_Synchronization/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_Synchronization/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STM32H743ZI-Nucleo board and can be
    easily tailored to any other supported device and development board.

  - STM32H743ZI-Nucleo Set-up
   Connect the following pins to an oscilloscope to monitor the different waveforms:
      - TIM1 CH1 (PA.08 Pin 23 CN12)
      - TIM3 CH1 (PC.06 Pin04 CN12)
      - TIM4 CH1 (PB.06 Pin17 CN12)


<u>How to use it ?</u>

In order to make the program work, you must do the following :
- Rebuild all files and load your image into target memory
- Run the example


=====================================================================================
<b>TIM_TimeBase</b>
Time Base example
=====================================================================================

<u>Example Description</u>

This example shows how to configure the TIM peripheral to generate a time base of
one second with the corresponding Interrupt request.

At the beginning of the main program the HAL_Init() function is called to reset
all the peripherals, initialize the Flash interface and the systick.
The SystemClock_Config() function is used to configure the system clock for STM32H743xx Devices :
The CPU at 400MHz
The HCLK for D1 Domain AXI and AHB3 peripherals , D2 Domain AHB1/AHB2 peripherals and D3 Domain AHB4  peripherals at 200MHz.
The APB clock dividers for D1 Domain APB3 peripherals, D2 Domain APB1 and APB2 peripherals and D3 Domain APB4 peripherals to  run at 100MHz

In this example TIM3 input clock (TIM3CLK)  is set to APB1 clock (PCLK1),
since APB1 prescaler is equal to 2.
  TIM3CLK = 2*PCLK1
  PCLK1 = HCLK/2 as AHB Clock divider is set to RCC_HCLK_DIV2
  =&gt; TIM3CLK = HCLK
To get TIM3 counter clock at 10 KHz, the Prescaler is computed as following:
Prescaler = (TIM3CLK / TIM3 counter clock) - 1
Prescaler = (HCLK /(10 KHz)) - 1

The TIM3 ARR register value is equal to 10000 - 1,
Update rate = TIM3 counter clock / (Period + 1) = 1 Hz,
So the TIM3 generates an interrupt each 1 s

When the counter value reaches the auto-reload register value, the TIM update
interrupt is generated and, in the handler routine, pin PB.00 (connected to LED1 on board STM32H743ZI-Nucleo)
is toggled at the following frequency: 0.5Hz.

In case of error, LED3 is turned ON.

Note: Care must be taken when using HAL_Delay(), this function provides accurate delay (in milliseconds)
      based on variable incremented in SysTick ISR. This implies that if HAL_Delay() is called from
      a peripheral ISR process, then the SysTick interrupt must have higher priority (numerically lower)
      than the peripheral interrupt. Otherwise the caller ISR process will be blocked.
      To change the SysTick interrupt priority you have to use HAL_NVIC_SetPriority() function.

Note: The example need to ensure that the SysTick time base is always set to 1 millisecond
      to have correct HAL operation.


<u>Directory contents</u>

  - TIM/TIM_TimeBase/Inc/stm32h7xx_hal_conf.h    HAL configuration file
  - TIM/TIM_TimeBase/Inc/stm32h7xx_it.h          Interrupt handlers header file
  - TIM/TIM_TimeBase/Inc/main.h                  Header for main.c module
  - TIM/TIM_TimeBase/Src/stm32h7xx_it.c          Interrupt handlers
  - TIM/TIM_TimeBase/Src/main.c                  Main program
  - TIM/TIM_TimeBase/Src/stm32h7xx_hal_msp.c     HAL MSP file
  - TIM/TIM_TimeBase/Src/system_stm32h7xx.c      STM32H7xx system source file


<u>Hardware and Software environment</u>

  - This example runs on STM32H743xx devices.

  - This example has been tested with STMicroelectronics STM32H743ZI-Nucleo
    board and can be easily tailored to any other supported device
    and development board.

  - STM32H743ZI-Nucleo Set-up
    - Use LED1 connected to PB.00 pin ((connected to LED1 on board STM32H743I-NUCLEO)) and connect it on an oscilloscope
      to show the Time Base signal.


<u>How to use it ?</u>

In order to make the program work, you must do the following :
 - Rebuild all files and load your image into target memory
 - Run the example



  <br\><b><a href="$CUR_DIR$/../../../../Documentation/STM32CubeH7GettingStarted.pdf">Getting started with STM32CubeH7 Embedded Software for STM32H7xx series</a></b>

  <br\><b><a href="$CUR_DIR$/../../../../Release_Notes.html">Release Notes for STM32CubeH7 Embedded Software</a></b>

  <br\><b><a href="$CUR_DIR$/../Release_Notes.html">Release Notes for STM32H743ZI-Nucleo Examples</a></b>

</span>
  </pre>
  </div>
  </body>
</html>

